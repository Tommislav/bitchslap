<html>
	<head>
		<meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0"/>

		<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css" />
		<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
		<script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>
	    <script src="/socket.io/socket.io.js"></script>
	    <script src="settings.js"></script>
    	
		<style>
		
		body, html {
			height: 100%;
		}
		
		div#main {
			background-color: magenta;
			font-size: 60px;
			color: white;
			font-weight: bold;
			font-family: Helvetica, Arial, sans-serif;
			vertical-align: middle;
			position: absolute;
			top: 0;
			bottom: 0;
			right: 0;
			left: 0;
			margin-bottom: 10px;
			margin-left: 10px;
			margin-right: 10px;
			width: 100%;
			height: 768px;
			
			
		}
		</style>
		
		<script>
	

            var id;
            var myname;




        var socket = io.connect(Settings.ServerUrl);
        $(document).on("vclick", "div#main", function () {
            // changeColor(getRandomColor());

            if (id != undefined) {
                    socket.emit('onClick', id);
            }
        });
		  
            function changeColor(color){
	            $("div#main").css("color", "#000");
	            $("div#main").css("background-color", color);
            }
		  
            function getRandomColor()
            {
	            return '#' + (0x1000000 + Math.random() * 0xFFFFFF).toString(16).substr(1, 6);
            }

            

            // Called when client is connected to server
            socket.on('connect', function () {
                // Called when client receives message from server
                socket.on('message', function (data) {

                    // Log to browser console
                    console.log(data);
                    // Add the message to the ul list
                    var li = document.createElement('li');
                    li.innerHTML = data.nick + " says: " + data.message;
                    document.getElementById('chat').appendChild(li);

                });


                socket.on('readyForNewGame', function () {
                    // Log to browser console

                });


                socket.on('playerStatus', function (data) {
                    // Log to browser console
                    console.log(data);

                    // Add the message to the ul list
                    var players = data.Players;
                    //    document.getElementById('main').innerHTML = "update from gameserver recieved";

                    for (i = 0; i < players.length; i++) {

                        var player = players[i];


                        if (player.id == id) {

                            var status = (player.alive) ? "Lever!" : "D&ouml;d";
                            var output = "<table border=0 width=100 height=100 border=10 bgcolor=" + player.color + "><tr><td> " + player.name + "<br>" + status + "</td></tr></table>";
                            //  document.getElementById('main').innerHTML += output;

                            alert(player.color);
                            document.getElementById('main').style.backgroundColor = player.color;
                            document.getElementById('main').innerHTML = "&nbsp;";

                        }
                    }
                });
            });

            function connectMe() {
                id = Math.round(Math.random() * 1000000 + 1);
             //   alert(id);
                socket.emit('connectPlayer', {"id": id });
            }


            function joinMe() {
                id = Math.round(Math.random() * 1000000 + 1);

                myname =  document.getElementById('namn').value;

                if (myname !="Your name" && myname != undefined && myname != "")
                    socket.emit('connectPlayer', { "id": id, "name": myname });
                else
                    document.getElementById('namn').style.borderColor = "red";
            }

            function clearIt() {
                document.getElementById('namn').value = ""; ;
            }
                

		</script>
	</head>
	
	<body>
		<div id="main" >
            
            Bitchslap!<br />
            
            <div id="register">
                    <input id="namn" type="text"  onfocus="clearIt(); return true;" name="namn" value="Your name"/>
                    <a href="javascript:joinMe()">Join</a>
            </div>

		</div>
	</body>
</html>